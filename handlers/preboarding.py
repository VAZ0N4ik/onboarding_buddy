# handlers/preboarding.py
"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–µ–±–æ—Ä–¥–∏–Ω–≥–∞
"""
import logging
from telegram import Update
from telegram.ext import ContextTypes

from config.settings import settings
from database.manager import db_manager
from database.models import UserStatus, OnboardingStage
from bot.keyboards import Keyboards

logger = logging.getLogger(__name__)


async def handle_preboarding(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ì–ª–∞–≤–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ–±–æ—Ä–¥–∏–Ω–≥–∞"""
    user_id = update.effective_user.id
    user = db_manager.get_user(user_id)

    if not user:
        await update.message.reply_text(
            "‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏."
        )
        return

    # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ –ø—Ä–µ–±–æ—Ä–¥–∏–Ω–≥ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–æ–≤—ã–π
    if user.status == UserStatus.NEW:
        db_manager.update_user_stage(user_id, OnboardingStage.REGISTRATION, UserStatus.PREBOARDING)

    db_manager.log_user_action(user_id, "preboarding_start", "–ù–∞—á–∞–ª –ø—Ä–µ–±–æ—Ä–¥–∏–Ω–≥")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
    if user.status == UserStatus.COMPLETED:
        text = """
üéâ –í—ã —É–∂–µ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –∞–¥–∞–ø—Ç–∞—Ü–∏–∏!

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ —É—Ç–æ—á–Ω–∏—Ç—å, –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —Ä–∞–∑–¥–µ–ª–∞–º:
‚Ä¢ ‚ùì FAQ - –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
‚Ä¢ üë• –ö–æ–Ω—Ç–∞–∫—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
‚Ä¢ üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞
"""
        await update.message.reply_text(text)
        return

    elif user.status in [UserStatus.PREBOARDED, UserStatus.ONBOARDING]:
        text = """
‚úÖ –ü—Ä–µ–±–æ—Ä–¥–∏–Ω–≥ —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω!

–í—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ä–∞–∑–¥–µ–ª—É "üìã –û–Ω–±–æ—Ä–¥–∏–Ω–≥" –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏.
"""
        await update.message.reply_text(text)
        return

    # –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –ø—Ä–µ–±–æ—Ä–¥–∏–Ω–≥–∞
    text = f"""
üéä –ü—Ä–∏–≤–µ—Ç, {update.effective_user.first_name}! 

–ú—ã —Ä–∞–¥—ã, —á—Ç–æ –≤—ã –ø—Ä–∏–Ω—è–ª–∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥–µ {settings.COMPANY_NAME}!

üè¢ **–û –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥–µ:**
–ú—ã —Å–æ—Å—Ç–æ–∏–º –∏–∑ —Ç–∞–ª–∞–Ω—Ç–ª–∏–≤—ã—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–∑–¥–∞—é—Ç –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ IT-—Ä–µ—à–µ–Ω–∏—è. –ö–∞–∂–¥—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤–∞–∂–µ–Ω –¥–ª—è –Ω–∞—Å, –∏ –º—ã —Å—Ç—Ä–µ–º–∏–º—Å—è —Å–æ–∑–¥–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∫–æ–º—Ñ–æ—Ä—Ç–Ω—É—é —Ä–∞–±–æ—á—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É.

üìã **–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–µ–±–æ—Ä–¥–∏–Ω–≥:**
‚Ä¢ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚Ä¢ –û–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏–µ —Å –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
‚Ä¢ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É - –æ–Ω–±–æ—Ä–¥–∏–Ω–≥—É

‚è±Ô∏è **–ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è:** 15-30 –º–∏–Ω—É—Ç

–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ?
"""

    keyboard = Keyboards.get_preboarding_start()
    await update.message.reply_text(text, reply_markup=keyboard)


async def handle_preboarding_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ callback-–æ–≤ –ø—Ä–µ–±–æ—Ä–¥–∏–Ω–≥–∞"""
    query = update.callback_query
    await query.answer()

    user_id = query.from_user.id
    callback_data = query.data

    if callback_data == "start_preboarding":
        await start_preboarding_process(query, context)
    elif callback_data == "docs_main":
        await show_main_documents(query, context)
    elif callback_data == "docs_tk":
        await show_tk_documents(query, context)
    elif callback_data == "docs_main_sent":
        await handle_docs_main_sent(query, context)
    elif callback_data == "docs_tk_sent":
        await handle_docs_tk_sent(query, context)
    elif callback_data == "all_docs_sent":
        await handle_all_docs_sent(query, context)


async def start_preboarding_process(query, context):
    """–ù–∞—á–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–µ–±–æ—Ä–¥–∏–Ω–≥–∞"""
    user_id = query.from_user.id

    db_manager.update_user_stage(user_id, OnboardingStage.DOCUMENTS_INTRO)
    db_manager.log_user_action(user_id, "preboarding_docs", "–ù–∞—á–∞–ª –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤")

    text = f"""
üìã **–î–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –Ω–∞ —Ä–∞–±–æ—Ç—É**

–î–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –≤ {settings.COMPANY_NAME} –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.

üìß **Email –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:** {settings.HR_EMAIL}

‚ö° **–í–∞–∂–Ω–æ:**
‚Ä¢ –û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–∫–∞–Ω—ã –∏–ª–∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
‚Ä¢ –í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–µ—Ç–∫–æ —á–∏—Ç–∞–µ–º—ã–º–∏
‚Ä¢ –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å: {settings.HR_TELEGRAM}

üìë **–î–æ–∫—É–º–µ–Ω—Ç—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ –¥–≤–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:**
‚Ä¢ –û—Å–Ω–æ–≤–Ω—ã–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö)
‚Ä¢ –ü–æ –¢—Ä—É–¥–æ–≤–æ–º—É –∫–æ–¥–µ–∫—Å—É –†–§ (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏)

–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è:
"""

    keyboard = Keyboards.get_document_categories()
    await query.edit_message_text(text, reply_markup=keyboard)


async def show_main_documents(query, context):
    """–ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã"""
    user_id = query.from_user.id
    db_manager.log_user_action(user_id, "docs_main_view", "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–ª —Å–ø–∏—Å–æ–∫ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤")

    text = f"""
üìÑ **–û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)**

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞ email: {settings.HR_EMAIL}

**–°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:**

1Ô∏è‚É£ **–ü–∞—Å–ø–æ—Ä—Ç** 
   ‚Ä¢ –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (—Ñ–æ—Ç–æ + –§–ò–û)
   ‚Ä¢ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –ø—Ä–æ–ø–∏—Å–∫–æ–π

2Ô∏è‚É£ **–ò–ù–ù** (—Å–ø—Ä–∞–≤–∫–∞ –∏–ª–∏ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ)

3Ô∏è‚É£ **–°–ù–ò–õ–°** (–∑–µ–ª–µ–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –∏–ª–∏ —Å–ø—Ä–∞–≤–∫–∞)

4Ô∏è‚É£ **–ê–¥—Ä–µ—Å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è**
   ‚Ä¢ –ï—Å–ª–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –ø—Ä–æ–ø–∏—Å–∫–∏ –≤ –ø–∞—Å–ø–æ—Ä—Ç–µ
   ‚Ä¢ –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–º –≤ –ø–∏—Å—å–º–µ

5Ô∏è‚É£ **–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã**
   ‚Ä¢ –ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –∏–ª–∏ —Ä–∞—Å—á–µ—Ç–Ω–æ–≥–æ —Å—á–µ—Ç–∞
   ‚Ä¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –°–±–µ—Ä–±–∞–Ω–∫ (–¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤)

‚ö†Ô∏è **–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:**
‚Ä¢ –í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–µ–π—Å—Ç–≤—É—é—â–∏–º–∏
‚Ä¢ –§–æ—Ç–æ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–µ—Ç–∫–∏–º–∏ –∏ —á–∏—Ç–∞–µ–º—ã–º–∏
‚Ä¢ –í —Ç–µ–º–µ –ø–∏—Å—å–º–∞ —É–∫–∞–∂–∏—Ç–µ: "–î–æ–∫—É–º–µ–Ω—Ç—ã - [–í–∞—à–µ –§–ò–û]"
"""

    keyboard = Keyboards.get_docs_main_menu()
    await query.edit_message_text(text, reply_markup=keyboard)


async def show_tk_documents(query, context):
    """–ü–æ–∫–∞–∑–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ –¢–ö –†–§"""
    user_id = query.from_user.id
    db_manager.log_user_action(user_id, "docs_tk_view", "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–ª —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ –¢–ö –†–§")

    text = f"""
üìë **–î–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ –¢—Ä—É–¥–æ–≤–æ–º—É –∫–æ–¥–µ–∫—Å—É –†–§**

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞ email: {settings.HR_EMAIL}

**–°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏):**

6Ô∏è‚É£ **–¢—Ä—É–¥–æ–≤–∞—è –∫–Ω–∏–∂–∫–∞** 
   ‚Ä¢ –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –∫–Ω–∏–∂–∫–∞
   ‚Ä¢ –ò–ª–∏ —Å–ø—Ä–∞–≤–∫–∞ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—Ç–∞ —Ä–∞–±–æ—Ç—ã
   ‚Ä¢ –î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è —Ç—Ä—É–¥–æ–≤–æ–≥–æ –¥–æ–≥–æ–≤–æ—Ä–∞

7Ô∏è‚É£ **–î–∏–ø–ª–æ–º –æ–± –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏**
   ‚Ä¢ –ï—Å–ª–∏ –∏–º–µ–µ—Ç—Å—è –≤—ã—Å—à–µ–µ/—Å—Ä–µ–¥–Ω–µ–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
   ‚Ä¢ –î–ª—è –∑–∞–ø–∏—Å–∏ –≤ —Ç—Ä—É–¥–æ–≤—É—é –∫–Ω–∏–∂–∫—É

8Ô∏è‚É£ **–°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ –±—Ä–∞–∫–µ**
   ‚Ä¢ –ï—Å–ª–∏ —Å–æ—Å—Ç–æ–∏—Ç–µ –≤ –±—Ä–∞–∫–µ
   ‚Ä¢ –î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –ª—å–≥–æ—Ç –∏ –æ—Ç–ø—É—Å–∫–æ–≤

9Ô∏è‚É£ **–°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏ –¥–µ—Ç–µ–π**
   ‚Ä¢ –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–ª–µ—Ç–Ω–∏–µ –¥–µ—Ç–∏
   ‚Ä¢ –î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –¥–µ—Ç—Å–∫–∏—Ö –ø–æ—Å–æ–±–∏–π –∏ –ª—å–≥–æ—Ç

üîü **–§–æ—Ç–æ –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —Å–∞–π—Ç–∞**
   ‚Ä¢ –î–µ–ª–æ–≤–æ–µ —Ñ–æ—Ç–æ (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ)
   ‚Ä¢ –î–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –≤ –∫–æ–º–∞–Ω–¥–µ –Ω–∞ —Å–∞–π—Ç–µ

üí° **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–æ–∫—É–º–µ–Ω—Ç—ã 6-9 –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏—Ö –Ω–∞–ª–∏—á–∏–∏.
"""

    keyboard = Keyboards.get_docs_tk_menu()
    await query.edit_message_text(text, reply_markup=keyboard)


async def handle_docs_main_sent(query, context):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤"""
    user_id = query.from_user.id
    user = db_manager.get_user(user_id)

    # –û–±–Ω–æ–≤–ª—è–µ–º —ç—Ç–∞–ø —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–µ–∫—É—â–∏–π —ç—Ç–∞–ø –º–µ–Ω—å—à–µ
    new_stage = max(user.stage, OnboardingStage.DOCUMENTS_MAIN)
    db_manager.update_user_stage(user_id, new_stage)
    db_manager.log_user_action(user_id, "docs_main_sent", "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –æ—Ç–ø—Ä–∞–≤–∫—É –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤")

    text = """
‚úÖ **–û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ**

üéØ **–ß—Ç–æ –¥–∞–ª—å—à–µ:**
‚Ä¢ –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ –¢–ö –†–§ - –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∏—Ö —Ç–æ–∂–µ
‚Ä¢ –ï—Å–ª–∏ –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã - –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é

üìß **–ù–µ –∑–∞–±—É–¥—å—Ç–µ:**
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–∏—Å—å–º–æ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ {settings.HR_EMAIL}
"""

    keyboard = Keyboards.get_docs_completion_menu()
    await query.edit_message_text(text, reply_markup=keyboard)


async def handle_docs_tk_sent(query, context):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ –¢–ö –†–§"""
    user_id = query.from_user.id
    user = db_manager.get_user(user_id)

    # –û–±–Ω–æ–≤–ª—è–µ–º —ç—Ç–∞–ø —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–µ–∫—É—â–∏–π —ç—Ç–∞–ø –º–µ–Ω—å—à–µ
    new_stage = max(user.stage, OnboardingStage.DOCUMENTS_TK)
    db_manager.update_user_stage(user_id, new_stage)
    db_manager.log_user_action(user_id, "docs_tk_sent", "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –æ—Ç–ø—Ä–∞–≤–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ –¢–ö –†–§")

    text = """
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ –¢–ö –†–§ –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ**

üéØ **–ß—Ç–æ –¥–∞–ª—å—à–µ:**
‚Ä¢ –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Ç–æ–∂–µ –≥–æ—Ç–æ–≤—ã - –∑–∞–≤–µ—Ä—à–∞–π—Ç–µ –ø—Ä–µ–±–æ—Ä–¥–∏–Ω–≥
‚Ä¢ –ï—Å–ª–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∏—Ö

üìß **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ:**
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ {settings.HR_EMAIL}
"""

    keyboard = Keyboards.get_docs_completion_menu()
    await query.edit_message_text(text, reply_markup=keyboard)


async def handle_all_docs_sent(query, context):
    """–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤"""
    user_id = query.from_user.id

    db_manager.update_user_stage(user_id, OnboardingStage.DOCUMENTS_COMPLETE, UserStatus.PREBOARDED)
    db_manager.log_user_action(user_id, "preboarding_complete", "–ó–∞–≤–µ—Ä—à–∏–ª –ø—Ä–µ–±–æ—Ä–¥–∏–Ω–≥")

    text = f"""
üéâ **–û—Ç–ª–∏—á–Ω–æ! –ü—Ä–µ–±–æ—Ä–¥–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω!**

‚úÖ **–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
‚Ä¢ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã
‚Ä¢ –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –ø–æ—Å—Ç—É–ø–∏–ª–∞ –≤ HR-–æ—Ç–¥–µ–ª

‚è≥ **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–∞–ª—å—à–µ:**
1. HR-–º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤–∞—à–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã (1-2 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è)
2. –ë—É–¥—É—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è (–¢–î, NDA –∏ –¥—Ä.)
3. –í—ã –ø–æ–ª—É—á–∏—Ç–µ –∏—Ö –Ω–∞ email –¥–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è –∏ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è

üìß **–ö–æ–Ω—Ç–∞–∫—Ç HR-–º–µ–Ω–µ–¥–∂–µ—Ä–∞:**
{settings.HR_TELEGRAM} - –¥–ª—è —Å—Ä–æ—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

üìö **–í –æ–∂–∏–¥–∞–Ω–∏–∏ –º–æ–∂–µ—Ç–µ:**
‚Ä¢ –ò–∑—É—á–∏—Ç—å —Ä–∞–∑–¥–µ–ª "üìö –ü–æ–ª–µ–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
‚Ä¢ –û–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å "‚ùì FAQ"
‚Ä¢ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã –±—É–¥—É—â–∏—Ö –∫–æ–ª–ª–µ–≥

üéØ **–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** 
–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ—Ç HR-–º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –∫ —ç—Ç–∞–ø—É **–æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞**.

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, –∫–æ–≥–¥–∞ –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:
"""

    keyboard = Keyboards.get_documents_received()
    await query.edit_message_text(text, reply_markup=keyboard)


async def get_preboarding_status(user_id: int) -> str:
    """–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø—Ä–µ–±–æ—Ä–¥–∏–Ω–≥–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    user = db_manager.get_user(user_id)

    if not user:
        return "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"

    if user.status == UserStatus.NEW:
        return "–ù–µ –Ω–∞—á–∞—Ç"
    elif user.status == UserStatus.PREBOARDING:
        stage_status = {
            OnboardingStage.REGISTRATION: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
            OnboardingStage.DOCUMENTS_INTRO: "–ò–∑—É—á–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π",
            OnboardingStage.DOCUMENTS_MAIN: "–û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤",
            OnboardingStage.DOCUMENTS_TK: "–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ –¢–ö –†–§",
        }
        return stage_status.get(user.stage, f"–≠—Ç–∞–ø {user.stage}")
    elif user.status == UserStatus.PREBOARDED:
        return "–ó–∞–≤–µ—Ä—à–µ–Ω ‚úÖ"
    else:
        return "–ü—Ä–æ–π–¥–µ–Ω"